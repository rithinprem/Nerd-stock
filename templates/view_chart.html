<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Candlestick Chart</title>
        <style>
                #chart {
                        width: 100%;
                        height: 79vh;
                        /* Adjust height based on view height */
                }
        </style>
        <link rel="stylesheet" href="../static/css/view_chart.css">
</head>

<body>


        <div id="chartContainer">
                <div id="stockName">{{stock_name}}</div>
                <div id="chart"></div>
        </div>
        <div class="bottom_bar">
                <div class="bottom_buttons">
                        <button type="button" class="button" style="margin-left: 1%;">5y</button>
                        <button type="button" class="button">1y</button>
                        <button type="button" class="button">3m</button>
                        <button type="button" class="button">1m</button>
                        <button type="button" class="button">5d</button>
                        <button type="button" class="button">1d</button>
                </div>
                <div id="timeDisplay"></div>
        </div>

        <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
        <script>
                const properties = {
                        layout: {
                                backgroundColor: '#000000',
                                textColor: '#131722',
                        },
                        grid: {
                                vertLines: {
                                        color: '#bbd9fb',
                                },
                                horzLines: {
                                        color: '#bbd9fb',
                                },
                        },
                        title: 'Stock Name',
                        timeScale: {
                                timeVisible: true,
                                secondsVisible: false,
                                borderColor: 'transparent',
                        },
                        rightPriceScale: { // Ensure you target the correct price scale (left or right as configured)
                                borderColor: 'transparent', // Making the border of the price scale transparent
                                drawTicks: false, // Optional: Do not draw tick marks
                        },

                };

                const dom = document.getElementById('chart');
                const chart = LightweightCharts.createChart(dom, properties);
                const candlestickSeries = chart.addCandlestickSeries();
                const data = {{ view_chart_api_result | tojson | safe }};
                candlestickSeries.setData(data);

                // Ensure the chart resizes dynamically with the window
                function resizeChart() {
                        chart.applyOptions({ width: dom.clientWidth, height: dom.clientHeight });
                }

                window.addEventListener('resize', resizeChart);
                resizeChart(); // Initial sizing

                function updateTime() {
                        var currentTime = new Date();

                        // Get the local timezone offset in minutes
                        var timezoneOffsetMinutes = currentTime.getTimezoneOffset();

                        // Convert the offset to milliseconds and subtract from the current time
                        var timezoneOffsetMilliseconds = timezoneOffsetMinutes * 60 * 1000;
                        currentTime.setTime(currentTime.getTime() + timezoneOffsetMilliseconds);

                        // Add 5 hours and 30 minutes to convert to Indian Standard Time (IST)
                        currentTime.setHours(currentTime.getHours() + 5);
                        currentTime.setMinutes(currentTime.getMinutes() + 30);

                        // Extract hours, minutes, and seconds
                        var istHours = currentTime.getHours();
                        var istMinutes = currentTime.getMinutes();
                        var istSeconds = currentTime.getSeconds();

                        // Format IST time nicely
                        var formattedIstTime = istHours + ":" + (istMinutes < 10 ? "0" : "") + istMinutes + ":" + (istSeconds < 10 ? "0" : "") + istSeconds;

                        // Set the time display content
                        document.getElementById('timeDisplay').innerText = formattedIstTime + "(UTC+5:30)";
                }

                // Update time initially and then every second
                updateTime();
                setInterval(updateTime, 1000);
        </script>
</body>

</html>